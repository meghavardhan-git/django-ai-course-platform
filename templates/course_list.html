{% extends 'base.html' %}
{% block title %}Courses{% endblock %}
{% block content %}
<hr>

<!-- Gemini Chatbot -->
<div style="position: fixed; bottom: 20px; right: 20px; width: 320px; max-height: 80vh; background: white; border: 1px solid #ccc; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.2); padding: 15px; overflow-y: auto;">
    <h3>Gemini AI Chatbot ü§ñ</h3>
    <textarea id="chat_input" rows="3" style="width: 100%;"></textarea>
    <button onclick="sendMessage()" style="margin-top: 10px; background:#3498db;color:white;padding:8px 16px;border:none;border-radius:5px;">Ask</button>
    <button onclick="suggestCourses()" style="margin-top: 10px; background:#2ecc71;color:white;padding:8px 16px;border:none;border-radius:5px;">Suggest</button>
    <div id="chat_response" style="margin-top: 10px; font-size: 14px;"></div>
</div>

<script>
function sendMessage() {
    const userInput = document.getElementById("chat_input").value;
    fetch("/gemini_chat/", {
        method: "POST",
        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}' },
        body: JSON.stringify({ message: userInput })
    }).then(response => response.json()).then(data => {
        document.getElementById("chat_response").innerText = data.response;
    });
}
function suggestCourses() {
    const userInput = document.getElementById("chat_input").value;
    fetch("/gemini_suggest_courses/", {
        method: "POST",
        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}' },
        body: JSON.stringify({ message: userInput })
    }).then(response => response.json()).then(data => {
        let html = "<h4>AI Suggestions:</h4>";
        data.suggestions.forEach(course => {
            html += `<b>${course.title}</b> (${course.category} - ${course.difficulty}): ${course.description}<br/><br/>`;
        });
        document.getElementById("chat_response").innerHTML = html;
    });
}
</script>

<!-- Search Bar -->
<div style="display: flex; justify-content: center; margin: 40px 0;">
    <form method="get" action="{% url 'course_list' %}" style="display: flex; width: 80%; max-width: 900px;">
        <input type="text" name="search" placeholder="Search courses..." value="{{ request.GET.search }}" style="flex-grow: 1; padding: 12px; font-size: 18px; border-radius: 50px 0 0 50px; border: 1px solid #ccc;">
        <select name="category" style="padding: 12px; border: 1px solid #ccc;">
            <option value="">All</option>
            <option value="Python" {% if request.GET.category == "Python" %}selected{% endif %}>Python</option>
            <option value="DSA" {% if request.GET.category == "DSA" %}selected{% endif %}>DSA</option>
            <option value="Web Development" {% if request.GET.category == "Web Development" %}selected{% endif %}>Web Dev</option>
            <option value="AI" {% if request.GET.category == "AI" %}selected{% endif %}>AI</option>
        </select>
        <button type="submit" style="padding: 12px 20px; background:#e74c3c; color:white; border:none; border-radius: 0 50px 50px 0;">üîç</button>
    </form>
</div>

<h2 style="text-align: center;">Courses</h2>

<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px;">
    {% for course in courses %}
        <div style="border-radius: 10px; overflow: hidden; box-shadow: 0 0 10px rgba(0,0,0,0.15); background: #fff;">
            {% if course.thumbnail_url %}
                <img src="{{ course.thumbnail_url }}" alt="Thumbnail" style="width:100%;height:200px;object-fit:cover;">
            {% else %}
                <iframe width="100%" height="200" src="https://www.youtube.com/embed/{{ course.youtube_link|slice:'-11:' }}" frameborder="0" allowfullscreen></iframe>
            {% endif %}
            <div style="padding: 15px;">
                <h3>{{ course.title }}</h3>
                <p style="color: #888;">{{ course.category }} | {{ course.difficulty }}</p>
                <p>{{ course.description|truncatewords:15 }}</p>
            </div>
        </div>
    {% empty %}
        <p>No courses found.</p>
    {% endfor %}
</div>
{% endblock %}
