{% extends 'base.html' %}
{% block title %}Courses{% endblock %}
{% block content %}
<hr>

<!-- Gemini AI Chatbot -->
<div style="position: fixed; bottom: 20px; right: 20px; width: 320px; max-height: 80vh; background: linear-gradient(135deg, #3498db, #8e44ad); border: 2px solid #2c3e50; border-radius: 15px; box-shadow: 0 8px 16px rgba(0,0,0,0.4); padding: 20px; overflow-y: auto; color: white; font-family: 'Segoe UI', sans-serif;">
    <h3 style="margin-top: 0;">Gemini AI Chatbot ü§ñ</h3>
    <textarea id="chat_input" rows="3" style="width: 100%; padding: 10px; border-radius: 10px; border: none;"></textarea>
    <button onclick="sendMessage()" style="margin-top: 10px; padding: 10px 20px; border-radius: 10px; border: none; background: #27ae60; color: white; font-weight: bold;">Ask</button>
    <button onclick="suggestCourses()" style="margin-top: 10px; padding: 10px 20px; border-radius: 10px; border: none; background: #f39c12; color: white; font-weight: bold;">Suggest Courses</button>
    <div id="chat_response" style="margin-top: 15px; font-size: 14px;"></div>
</div>

<script>
function sendMessage() {
    const userInput = document.getElementById("chat_input").value;
    fetch("/gemini_chat/", {
        method: "POST",
        headers: {'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}'},
        body: JSON.stringify({ message: userInput })
    }).then(response => response.json()).then(data => {
        document.getElementById("chat_response").innerText = data.response;
    });
}

function suggestCourses() {
    const userInput = document.getElementById("chat_input").value;
    fetch("/gemini_suggest_courses/", {
        method: "POST",
        headers: {'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}'},
        body: JSON.stringify({ message: userInput })
    }).then(response => response.json()).then(data => {
        let html = "<h4>AI Course Recommendations:</h4>";
        data.suggestions.forEach(course => {
            html += `<b>${course.title}</b> (${course.category} - ${course.difficulty}): ${course.description}<br/><br/>`;
        });
        document.getElementById("chat_response").innerHTML = html;
    });
}
</script>

<!-- Search bar -->
<div style="display: flex; justify-content: center; margin: 40px 0;">
    <form method="get" action="{% url 'course_list' %}" style="display: flex; width: 80%; max-width: 900px;">
        <input type="text" name="search" placeholder="Search courses..." value="{{ request.GET.search }}" style="flex-grow: 1; padding: 12px 20px; font-size: 18px; border-radius: 50px 0 0 50px; border: 1px solid #ccc;">
        <select name="category" style="padding: 12px 20px; font-size: 16px; border: 1px solid #ccc; background: #f8f8f8;">
            <option value="">All Categories</option>
            <option value="Python" {% if request.GET.category == "Python" %}selected{% endif %}>Python</option>
            <option value="DSA" {% if request.GET.category == "DSA" %}selected{% endif %}>DSA</option>
            <option value="Web Development" {% if request.GET.category == "Web Development" %}selected{% endif %}>Web Development</option>
            <option value="AI" {% if request.GET.category == "AI" %}selected{% endif %}>AI</option>
        </select>
        <button type="submit" style="padding: 12px 25px; font-size: 18px; border-radius: 0 50px 50px 0; background-color: #FF0000; color: white; border: none;">üîç</button>
    </form>
</div>

<h2 style="text-align: center;">Course Search Results</h2>
<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; padding: 20px;">
    {% for course in courses %}
        <div style="border-radius: 10px; overflow: hidden; box-shadow: 0 0 15px rgba(0,0,0,0.3); background: #fff; transition: transform 0.3s ease;">
            <a href="{% url 'course_detail' course.id %}" style="text-decoration: none; color: inherit;">
            {% if course.thumbnail_url %}
                <img src="{{ course.thumbnail_url }}" alt="Thumbnail" style="width: 100%; height: 200px; object-fit: cover;">
            {% else %}
                <iframe width="100%" height="200" src="https://www.youtube.com/embed/{{ course.youtube_link|slice:'-11:' }}" frameborder="0" allowfullscreen></iframe>
            {% endif %}
            <div style="padding: 15px;">
                <h3>{{ course.title }}</h3>
                <p style="color: #888;">{{ course.category }} | {{ course.difficulty }}</p>
                <p>{{ course.description|truncatewords:15 }}</p>
            </div>
            </a>
        </div>
    {% empty %}
        <p style="text-align: center;">No courses found.</p>
    {% endfor %}
</div>

<hr>

<h2 style="text-align: center;">Recommended Videos</h2>
<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; padding: 20px;">
    {% for rec in recommended_videos %}
        <div style="border-radius: 10px; overflow: hidden; box-shadow: 0 0 15px rgba(0,0,0,0.3); background: #fff;">
            <iframe width="100%" height="200" src="https://www.youtube.com/embed/{{ rec.youtube_id }}" frameborder="0" allowfullscreen></iframe>
            <div style="padding: 15px;"><h3>{{ rec.title }}</h3></div>
        </div>
    {% endfor %}
</div>

{% endblock %}
